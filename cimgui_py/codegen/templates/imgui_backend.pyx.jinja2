# cython: language_level=3
# cython: embedsignature=True
# distutils: language=c++
"""imgui_backend.pyx - Auto-generated GLFW + OpenGL3 backend bindings

DO NOT EDIT - regenerate with: python codegen/compiler.py
"""

from libc.stdint cimport uintptr_t
from cpython.bytes cimport PyBytes_AsString

cimport cimgui

# ==============================================================================
# Helpers
# ==============================================================================

cdef inline bytes _to_bytes(s):
    """str -> bytes"""
    if isinstance(s, bytes):
        return s
    if s is None:
        return b''
    return s.encode('utf-8')

{# ============================================================================
   Macro: convert argument for C call
   ============================================================================ #}
{% macro convert_arg(arg) -%}
{% if arg.conversion == 'to_bytes' -%}
_to_bytes({{ arg.name }})
{%- elif arg.conversion == 'ptr_to_int' -%}
<{{ arg.cython_type }}>{{ arg.name }}
{%- elif arg.conversion == 'unwrap_ptr' -%}
{{ arg.name }}._ptr if {{ arg.name }} is not None else NULL
{%- else -%}
{{ arg.name }}
{%- endif %}
{%- endmacro %}

{# ============================================================================
   Macro: generate function call arguments
   ============================================================================ #}
{% macro call_args(args) -%}
{% for arg in args %}{{ convert_arg(arg) }}{% if not loop.last %}, {% endif %}{% endfor %}
{%- endmacro %}

{# ============================================================================
   Macro: generate def signature
   ============================================================================ #}
{% macro def_args(args) -%}
{% for arg in args %}{{ arg.name }}{% if arg.default is not none %} = {{ arg.default }}{% endif %}{% if not loop.last %}, {% endif %}{% endfor %}
{%- endmacro %}

# ==============================================================================
# GLFW Backend
# ==============================================================================

{% if 'glfw' in backends %}
{% for func in backends['glfw'] %}
def glfw_{{ func.python_name }}({{ def_args(func.args) }}){% if func.ret_python != 'None' %} -> {{ func.ret_python }}{% endif %}:
    """{{ func.cimgui_name }}"""
{% if func.ret_type == 'void' %}
    cimgui.{{ func.cimgui_name }}({{ call_args(func.args) }})
{% else %}
    return cimgui.{{ func.cimgui_name }}({{ call_args(func.args) }})
{% endif %}
{% endfor %}
{% endif %}

# ==============================================================================
# OpenGL3 Backend
# ==============================================================================

{% if 'opengl3' in backends %}
{% for func in backends['opengl3'] %}
def opengl3_{{ func.python_name }}({{ def_args(func.args) }}){% if func.ret_python != 'None' %} -> {{ func.ret_python }}{% endif %}:
    """{{ func.cimgui_name }}"""
{% if func.ret_type == 'void' %}
    cimgui.{{ func.cimgui_name }}({{ call_args(func.args) }})
{% else %}
    return cimgui.{{ func.cimgui_name }}({{ call_args(func.args) }})
{% endif %}
{% endfor %}
{% endif %}
