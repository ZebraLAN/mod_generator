# cython: language_level=3
# cimgui.pxd - Auto-generated from cimgui JSON definitions
# Dear ImGui (docking branch) - 纯 C API
#
# DO NOT EDIT - regenerate with: python codegen/compiler.py
#
# 架构说明：
# - 使用 CIMGUI_DEFINE_ENUMS_AND_STRUCTS 宏
# - cimgui.h 自己定义所有类型 (ImVec2, ImVec4, enums, structs)
# - 我们只需要声明 Cython 需要的类型别名

from libc.stdint cimport uint8_t, uint16_t, uint32_t, uint64_t, int8_t, int16_t, int32_t, int64_t
from libc.stddef cimport size_t

cdef extern from "cimgui.h":

    # ==========================================================================
    # Basic Type Aliases (来自 cimgui.h)
    # ==========================================================================
    ctypedef uint32_t ImGuiID
    ctypedef uint8_t ImU8
    ctypedef uint16_t ImU16
    ctypedef uint32_t ImU32
    ctypedef uint64_t ImU64
    ctypedef int8_t ImS8
    ctypedef int16_t ImS16
    ctypedef int32_t ImS32
    ctypedef int64_t ImS64
    ctypedef uint16_t ImWchar
    ctypedef uint16_t ImWchar16
    ctypedef uint32_t ImWchar32
    ctypedef uint64_t ImTextureID
    ctypedef unsigned short ImDrawIdx

    # ==========================================================================
    # Value-Type Structs (按值传递，需要完整定义)
    # 自动从 structs_and_enums.json 的 nonPOD_used 生成
    # 注意顺序：基础类型先定义，依赖它们的后定义
    # ==========================================================================
{# 第一遍：没有 Im* 字段依赖的基础类型 #}
{% for struct in structs.values() if struct.is_value_type and struct.has_simple_fields %}
{% set has_im_dep = namespace(value=false) %}
{% for field in struct.simple_fields %}{% if field.cython_type.startswith('Im') %}{% set has_im_dep.value = true %}{% endif %}{% endfor %}
{% if not has_im_dep.value %}
    ctypedef struct {{ struct.name }}:
{% for field in struct.simple_fields %}
        {{ field.cython_type }} {{ field.name }}
{% endfor %}

{% endif %}
{% endfor %}
{# 第二遍：有 Im* 字段依赖的复合类型 #}
{% for struct in structs.values() if struct.is_value_type and struct.has_simple_fields %}
{% set has_im_dep = namespace(value=false) %}
{% for field in struct.simple_fields %}{% if field.cython_type.startswith('Im') %}{% set has_im_dep.value = true %}{% endif %}{% endfor %}
{% if has_im_dep.value %}
    ctypedef struct {{ struct.name }}:
{% for field in struct.simple_fields %}
        {{ field.cython_type }} {{ field.name }}
{% endfor %}

{% endif %}
{% endfor %}

    # ==========================================================================
    # Full Struct Definitions (需要字段访问的结构体)
    # 这些结构体通过 wrapper 类的 @property 暴露字段
    # ==========================================================================
{% for stname in type_map.FULL_STRUCT_DEFS %}
{% set struct = structs.get(stname) %}
{% if struct %}
    ctypedef struct {{ stname }}:
{% for field in struct.fields %}
{% if not field.skip and field.cython_type != '__UNKNOWN__' %}
{% set clean_name = field.name | strip_array_suffix %}
{% if field.size is not none %}
        {{ field.cython_type }} {{ clean_name }}[{{ field.size }}]
{% else %}
        {{ field.cython_type }} {{ clean_name }}
{% endif %}
{% endif %}
{% endfor %}

{% endif %}
{% endfor %}

    # ==========================================================================
    # Opaque Struct Forward Declarations (只通过指针使用)
    # ==========================================================================
{% for struct in structs.values() if not struct.is_value_type and struct.name not in type_map.FULL_STRUCT_DEFS %}
    ctypedef struct {{ struct.name }}
{% endfor %}

    # ==========================================================================
    # Enums (cimgui.h 定义，我们只需要常量值)
    # ==========================================================================
{% for enum in enums %}
    cdef enum {{ enum.name }}:
{% for name, value in enum.values %}
        {{ name }} = {{ value }}
{% endfor %}

{% endfor %}

    # ==========================================================================
    # Functions
    # ==========================================================================
{% for func in functions %}
{# 跳过包含未知类型的函数 #}
{% set has_unknown = namespace(value=false) %}
{% for arg in func.args %}{% if arg.cython_type == '__UNKNOWN__' %}{% set has_unknown.value = true %}{% endif %}{% endfor %}
{% if func.ret_cython != '__UNKNOWN__' and not has_unknown.value and not func.has_vararg %}
    {{ func.ret_cython }} {{ func.ov_cimguiname }}({% for arg in func.args %}{{ arg.cython_type }} {{ arg.name }}{% if not loop.last %}, {% endif %}{% endfor %})
{% endif %}
{% endfor %}

    # ==========================================================================
    # Struct Methods (自动生成的 wrapper 类需要调用这些函数)
    # ==========================================================================
{% for stname, method_list in methods.items() %}
{% if stname in type_map.WRAPPER_TYPES %}
    # {{ stname }} methods
{% for func in method_list %}
{% set has_unknown = namespace(value=false) %}
{% for arg in func.args %}{% if arg.cython_type == '__UNKNOWN__' %}{% set has_unknown.value = true %}{% endif %}{% endfor %}
{% if func.ret_cython != '__UNKNOWN__' and not has_unknown.value %}
    {{ func.ret_cython }} {{ func.ov_cimguiname }}({{ stname }}* self{% for arg in func.args %}, {{ arg.cython_type }} {{ arg.name }}{% endfor %})
{% endif %}
{% endfor %}

{% endif %}
{% endfor %}
